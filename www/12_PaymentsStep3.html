<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <!--Import Google Icon Font-->
  <link href="assets/css/icon.css?family=Material+Icons" rel="stylesheet">

  <!--Import materialize.css-->
  <link type="text/css" rel="stylesheet" href="assets/css/materialize.min.css"  media="screen,projection"/>
  <!--Import my style-->
  <link type="text/css" href="assets/css/custom.css" rel="stylesheet"/>
  <!--Let browser know website is optimized for mobile-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body class="profile">
  <!--Nav Main-->
  <div class="navbar-fixed nav-descktop"></div>

  <!--Nav Responsive-->
  <nav class="nav-app">
    <div class="nav-wrapper">
      <a href="#!" class="brand-logo center">Histórico de mi pago</a>
      <ul class="left ">
        <li><a href="12_PaymentsStep2.html?section=mis_pagos"><i class="material-icons">keyboard_arrow_left</i></a></li>
      </ul>
    </div>
  </nav>
  <div class="progress">
    <div class="indeterminate"></div>
  </div> 

  <div class="wrapper">
    <div class="container">
      <div class="row">
        <div class="col s12 pag-nav">
          <span class="btn-nav-pag">
            <a href="12_PaymentsStep2.html?section=mis_pagos" class="btn grey lighten-1"><i class="material-icons left">&nbsp;</i>Volver</a>
          </span>
        </div>
        <div class="col s12">
          <h3 class="center hide-on-med-and-down">Histórico de mi pago</h3>
          <br>
        </div>
        <div class="col s6 m4 l2">
          <h4 class="margin-bottom-0"><span class="user_u"></span></h4>
          <h6>Nombre de usuario</h6>
        </div>

        <div class="col s12">
          <ul class="item-profile">
            <li class="middle-li-historic">
              <h5>
                <small>Monto prestado</small><br>
                $<span class="total_b"></span>
              </h5>
            </li>
            <li class="middle-li-historic">
              <h5>
                <small>Valor cuota</small><br>
                $<span class="quota_b"></span>
              </h5>
            </li>
            <li class="middle-li-historic">
              <h5>
                <small>Interéses</small><br>
                %<span class="interes_b"></span>
              </h5>
            </li>
            <li class="middle-li-historic">
              <h5>
                <small>Cuota</small><br>
                <strong class="cuota"></strong> de <strong><span class="cuotas"></span></strong>
              </h5>
            </li>
            <div class="clear"></div>
            <li>
              <h5>
                <small>Última fecha de pago</small><br>
                <span class="fecha_pago"></span>
              </h5>
            </li>
            <li>
              <h5>
                <small>Estado del pago</small><br>
                <strong class="green-text text-lighten-1 estado_pago">Pagado</strong>
              </h5>
            </li>
          </ul>
        </div>
        <div class="col s12 qualify-earning">
          <a href="#modal3">
            <i class="material-icons">star_border</i>
            <p>Califica esta inversión</p>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Structure Load -->
  <div id="modal3" class="modal">
    <a href="#!" class="modal-action modal-close"><i class="material-icons close">close</i></a>
    <div class="modal-content content-done valign-wrapper">
      <div class="row content-moda">
        <div class="col s12">
          <ul class="qualify-star">
            <li>
              <a href="#!"><i id="start1" class="material-icons">star_border</i></a>
            </li>
            <li>
              <a href="#!"><i id="start2" class="material-icons">star_border</i></a>
            </li>
            <li>
              <a href="#!"><i id="start3" class="material-icons">star_border</i></a>
            </li>
            <li>
              <a href="#!"><i id="start4" class="material-icons">star_border</i></a>
            </li>
            <li>
              <a href="#!"><i id="start5" class="material-icons">star_border</i></a>
            </li>
          </ul>
          <p>Califica que tan a gusto estás con esta inversión y déjanos tu comentario del porque.</p>
        </div>

        <form class="col s12">
          <div class="row">
            <div class="input-field col s12">
              <textarea id="comentarios" name="comentarios" placeholder="Comentar" class="materialize-textarea"></textarea>
              <input type="hidden" id="to_u" name="to_u" value="">
              <input type="hidden" id="calificacion" name="calificacion" value="">
            </div>
          </div>
        </form>

        <div class="col s12 center margin-top-40 btn-register">
          <a class="waves-effect waves-light green accent-4 btn-large comentar">Comentar</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="page-footer">
    <div class="footer-copyright">
      <div class="container">
        © 2017 BankU
      </div>
    </div>
  </footer>

  <!--Nav footer Responsive-->
  <div class="footer-nav menu_footer"></div>
  <!-- Modal Structure -->
  <div id="info2" class="modal">
    <div class="modal-content">
      <h4>Datos enviados exitosamente</h4>
      <p>La calificación fue enviada exitosamente.</p>
      <p>Gracias.</p>
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat">Aceptar</a>
    </div>
  </div>

  <script type="text/javascript" src="cordova.js"></script>
  <script type="text/javascript" src="index.js"></script>
  <!--Import jQuery before materialize.js-->
  <script type="text/javascript" src="assets/js/jquery-2.1.1.min.js"></script>
  <script type="text/javascript" src="assets/js/materialize.min.js"></script>
  <script type="text/javascript" src="assets/js/jquery.validate.min.js"></script>
  <script type="text/javascript" src="assets/js/numeral.min.js"></script>
  <script src="assets/js/socket.io.js"></script>
  <script type="text/javascript" src="assets/js/tools.js?v=1.0.0"></script>
  <script type="text/javascript" src="assets/js/includes.js?v=1.0.0"></script>
  <script type="text/javascript">
    $( document ).ready(function(){
      getScroll();
      $('#comentarios').trigger('autoresize');
      var id_b=getUrlParameter("id_b");
      $( ".qualify-star li a i" ).click(function() {
        $( ".qualify-star li a i" ).css("color","#dedede");
        var id= $(this).attr("id").split("start");
        $("#calificacion").val(id[1]);
        for(var i=1;i<=id[1];i++){
          $("#start"+i).css("color","#ffd600");
        }
        $(this).css("color","#ffd600");
      });
      $( ".comentar" ).click(function() {
        var comentarios=$("#comentarios").val();
        if(comentarios!=""){
          var id_b= getUrlParameter("id_b");
          var to_u= $("#to_u").val();
          var rate= $("#calificacion").val();
          $.ajax({
            type: "POST",
            url: "http://bankucolombia.com/lib/ajax_service_mobil.php",
            data: "action=setCalifications&from_u="+localStorage.id_u+"&to_u="+to_u+"&id_b="+id_b+"&rate="+rate+"&comments="+comentarios,
            dataType:'JSON',
            success: function(msg){
              if(msg.status==200){                                                   
                $("#comentarios").val('');
                $("#comentarios").removeClass("error");
                $('#info2').modal('open',{
                  dismissible: true,
                  complete: function() { location.reload(); }
                }
                );
              }
            }
          });
        }else{
          $("#comentarios").addClass("error");
        }
      });


                //Obtener datos generales
                $.ajax({
                  type: "POST",
                  url: "http://bankucolombia.com/lib/ajax_service_mobil.php",
                  data: "action=getBusiness&id_b="+id_b+"&id_user="+localStorage.id_u+"&type_user="+localStorage.type_user,
                  dataType:'JSON',
                  success: function(msg){
                    $.each(msg.data, function( index, value ) {
                      var starts= getStarts(value.calification2_u);
                      $("#to_u").val(value.id_u_inv);
                      $(".user_u").html(value.user_inv);
                      $(".ldestination").html(value.ldestination);
                      $(".interes_b").html(value.interes_b);
                      $(".plazo_b").html(value.plazo_b);
                      $(".total_b").html(numeral(value.total_b).format('0,0'));
                      $(".quota_b").html(numeral(value.quota_b).format('0,0'));
                      $(".calification_u").html(getCalification(value.calification_u));
                      if(value.calification){
                        var starts='';
                        for(var i=1;i<value.calification;i++){
                          starts+='<i class="material-icons yellow-text text-accent-4">star_border</i>';
                        }
                        $(".qualify-earning").html(starts);
                      }
                    });
                  },
                  error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Problemas procesando datos: " + textStatus +" - "+errorThrown);
                  }
                });
                //Obtener detalle de pagos
                $.ajax({
                  type: "POST",
                  url: "http://bankucolombia.com/lib/ajax_service_mobil.php",
                  data: "action=getPaysxBusiness&id_b="+id_b,
                  dataType:'JSON',
                  success: function(msg){
                    var cont=0;
                    var pagadas=0;
                    var fecha='N/D';
                    var estado='Pendiente';
                    $.each(msg.data, function( index, value ) {
                      if(value.status_p==1){
                        pagadas++;
                        fecha=value.datepay_p;
                        estado='Pagado';
                      }
                      cont++;
                    });
                    $(".cuotas").html(cont);
                    $(".cuota").html(pagadas + 1);
                    $(".fecha_pago").html(fecha);
                    $(".estado_pago").html(estado);
                  },
                  error: function(XMLHttpRequest, textStatus, errorThrown) {
                    alert("Problemas procesando datos: " + textStatus +" - "+errorThrown);
                  }
                });

              })
            </script>
          </body>
          </html>